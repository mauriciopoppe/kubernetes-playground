import{_ as i,c as a,o as n,ae as e}from"./chunks/framework.CDjunVez.js";const g=JSON.parse('{"title":"Kubernetes development","description":"","frontmatter":{},"headers":[],"relativePath":"kubernetes-development.md","filePath":"kubernetes-development.md"}'),h={name:"kubernetes-development.md"};function l(k,s,t,p,r,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="kubernetes-development" tabindex="-1">Kubernetes development <a class="header-anchor" href="#kubernetes-development" aria-label="Permalink to &quot;Kubernetes development&quot;">​</a></h1><h2 id="compiling-binaries-in-debug-mode" tabindex="-1">Compiling binaries in debug mode <a class="header-anchor" href="#compiling-binaries-in-debug-mode" aria-label="Permalink to &quot;Compiling binaries in debug mode&quot;">​</a></h2><p><strong>Main doc: <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/development.md#building-kubernetes" target="_blank" rel="noreferrer">contributors/devel/development.md</a></strong></p><p>Run <code>make WHAT=cmd/&lt;target&gt;</code>, the binaries are at <code>_output/bin/&lt;target&gt;</code>, for example to build the kube-controller-manager:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DBG=1 sets the gcflags &#39;all=-N -l&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WHAT=cmd/kube-controller-manager</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DBG=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><h2 id="compiling-binaries-in-debug-mode-within-the-kubernetes-builder-container" tabindex="-1">Compiling binaries in debug mode within the kubernetes builder container <a class="header-anchor" href="#compiling-binaries-in-debug-mode-within-the-kubernetes-builder-container" aria-label="Permalink to &quot;Compiling binaries in debug mode within the kubernetes builder container&quot;">​</a></h2><p>In the kubernetes codebase, create the file <code>build/make-in-container.sh</code> with the following contents</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Copyright 2014 The Kubernetes Authors.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># you may not use this file except in compliance with the License.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You may obtain a copy of the License at</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Unless required by applicable law or agreed to in writing, software</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># See the License for the specific language governing permissions and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># limitations under the License.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Runs a command inside the builder image, it could be used to build a binary.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> errexit</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nounset</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pipefail</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KUBE_ROOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BASH_SOURCE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0]}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/..</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KUBE_ROOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/build/common.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KUBE_ROOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/build/lib/release.sh&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KUBE_RELEASE_RUN_TESTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${KUBE_RELEASE_RUN_TESTS-y}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube::build::verify_prereqs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube::build::build_image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube::build::run_build_command</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> $@</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube::build::copy_output</span></span></code></pre></div><p>Then call it like this:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KUBE_VERBOSE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KUBE_FASTBUILD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KUBE_RELEASE_RUN_TESTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">n</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ./build/make-in-container.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WHAT=cmd/kubelet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DBG=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p>This is useful for some components like the kubelet that kind runs inside an Ubuntu container, with the above we can cross compile it with the linux/arm64 arch and replace it in a running kind cluster.</p><h2 id="debug-a-binary-with-delve" tabindex="-1">Debug a binary with delve <a class="header-anchor" href="#debug-a-binary-with-delve" aria-label="Permalink to &quot;Debug a binary with delve&quot;">​</a></h2><p>I use <a href="https://github.com/go-delve/delve" target="_blank" rel="noreferrer">delve</a> to run the binaries in debug mode</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># download delve</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github.com/go-delve/delve/cmd/dlv@v1.9.1</span></span></code></pre></div><p><strong>Headless debugging</strong></p><p>Run delve in server mode with a debug binary (it creates a delve server, it connects to the server and starts the target binary), it waits for a client to connect to the server through an editor.</p><p>See <code>/docs/sandbox-with-debugger.yaml</code> for more info about my neovim setup.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># run the program in server headless mode through delve</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dlv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --listen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :38697</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --continue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --accept-multiclient</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --api-version=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --headless</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./_output/bin/kube-controller-manager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --kubeconfig=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOME</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/.kube/config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --leader-elect=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --controllers=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Use your editor&#39;s dap integration to attach your editor to the running program</span></span></code></pre></div><h2 id="using-kind" tabindex="-1">Using kind <a class="header-anchor" href="#using-kind" aria-label="Permalink to &quot;Using kind&quot;">​</a></h2><p>Read:</p><ul><li><a href="https://kind.sigs.k8s.io/docs/user/quick-start/#building-images" target="_blank" rel="noreferrer">https://kind.sigs.k8s.io/docs/user/quick-start/#building-images</a></li><li><a href="https://github.com/kubernetes/community/blob/master/contributors/devel/development.md#building-kubernetes-with-docker" target="_blank" rel="noreferrer">https://github.com/kubernetes/community/blob/master/contributors/devel/development.md#building-kubernetes-with-docker</a></li></ul><p>Steps:</p><ul><li>Clone the kubernetes codebase to <code>$GOPATH/src/k8s.io/kubernetes</code></li><li>Read the steps in <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/development.md#building-kubernetes-on-a-local-osshell-environment" target="_blank" rel="noreferrer">https://github.com/kubernetes/community/blob/master/contributors/devel/development.md#building-kubernetes-on-a-local-osshell-environment</a>, install dependencies if needed</li><li>Run <code>kind build node-image</code></li><li>Create a configuration file like the one in <code>/kind-sandbox</code> e.g.</li><li>Start kind with <code>kind create cluster --config=./config.yaml --image=kindest/node:main</code></li></ul><h3 id="how-does-kind-build-node-image-work" tabindex="-1">How does <code>kind build node-image</code> work? <a class="header-anchor" href="#how-does-kind-build-node-image-work" aria-label="Permalink to &quot;How does \`kind build node-image\` work?&quot;">​</a></h3><p>Public docs: <a href="https://kind.sigs.k8s.io/docs/design/node-image/" target="_blank" rel="noreferrer">https://kind.sigs.k8s.io/docs/design/node-image/</a></p><p>This is my analysis of what&#39;s going on under the hood in <a href="https://github.com/kubernetes-sigs/kind/blob/main/pkg/build/nodeimage/" target="_blank" rel="noreferrer">https://github.com/kubernetes-sigs/kind/blob/main/pkg/build/nodeimage/</a></p><ul><li>chdir to the kubernetes project root, it&#39;s assumed to be at $GOPATH/src/k8s.io/kubernetes</li><li>run the following command to build the binaries:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quick-release-images</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  KUBE_VERBOSE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBE_BUILD_HYPERKUBE=n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBE_BUILD_CONFORMANCE=n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBE_BUILD_PLATFORMS=linux/arm64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  KUBE_EXTRA_WHAT=&quot;cmd/kubeadm cmd/kubectl cmd/kubelet&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:33]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Verifying</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Prerequisites....</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:33]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Using</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> macOS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:34]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Building</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-build:build-976d986f6a-5-v1.25.0-go1.19-bullseye.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:42]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Syncing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sources</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:44]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:46]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Building</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> targets</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linux/arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/hack/make-rules/helpers/go2make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (non-static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:50]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prerelease</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lifecycle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> targets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:53]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deepcopy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 242</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> targets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:24:58]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> defaulter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 95</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> targets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:04]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conversion</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 132</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> targets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:15]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openapi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:30]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openapi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AGGREGATOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:31]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openapi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> APIEXTENSIONS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:32]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openapi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CODEGEN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:33]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openapi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SAMPLEAPISERVER</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:25:34]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Building</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> targets</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linux/arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kube-apiserver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kube-controller-manager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kube-scheduler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kube-proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kubeadm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kubectl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s.io/kubernetes/cmd/kubelet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (non-static)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:26:48]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Syncing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:26:52]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Building</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linux-arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:26:52]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-apiserver-arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:26:52]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-controller-manager-arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:26:52]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-scheduler-arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:26:52]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-proxy-arm64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:27:00]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Deleting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.k8s.io/kube-scheduler-arm64:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:27:01]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Deleting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.k8s.io/kube-proxy-arm64:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:27:03]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Deleting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.k8s.io/kube-controller-manager-arm64:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:27:06]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Deleting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.k8s.io/kube-apiserver-arm64:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [0115 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12:27:06]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> builds</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> done</span></span></code></pre></div><ul><li>Output will be at <a href="https://github.com/kubernetes-sigs/kind/blob/aa147e7bd41f4aa868a374ce91688714c40c1ca3/pkg/build/nodeimage/internal/kube/builder_docker.go#L137-L142" target="_blank" rel="noreferrer">these locations</a>:</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubernetes/_output/dockerized/bin/linux/arm64/{kubeadm,kubelet,kubectl}</span></span>
<span class="line"><span>kubernetes/_output/release-images/arm64/kube-{apiserver,controller-manager,proxy,scheduler}.tar</span></span></code></pre></div><ul><li>It then runs a prebuilt kind base image <a href="https://github.com/kubernetes-sigs/kind/blob/main/images/base/Dockerfile" target="_blank" rel="noreferrer">docker.io/kindest/base</a></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># it actually runs it in detached mode</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --privileged</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --entrypoint=sleep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name=kind-build-manual</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --platform=linux/arm64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --security-opt=seccomp=unconfined</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.io/kindest/base:v20221220-6c392628</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> infinity</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># copy binaries to node e.g. kubeadm, set chmod +x and chown root:root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binaries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binaries</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $PWD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/_output/dockerized/bin/linux/arm64/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind-build-manual:/usr/bin/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-build-manual</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-build-manual</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root:root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># write kubernetes version to /kind/version</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># inside the image:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@2b82bed39fe5:/kind#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;v1.25.0-dirty&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /kind/version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># list images required by kubeadm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@6f7a5781ab5c:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --kubernetes-version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/kube-apiserver:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/kube-controller-manager:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/kube-scheduler:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/kube-proxy:v1.25.0-dirty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/pause:3.8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/etcd:3.5.4-0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/coredns/coredns:v1.9.3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># replace the pause image with kind&#39;s pause image</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add CNI images, create default manifests (https://github.com/kubernetes-sigs/kind/blob/main/pkg/build/nodeimage/const_cni.go)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@2b82bed39fe5:/kind#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /kind/manifests/default-cni.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add storage images, create default manifests (https://github.com/kubernetes-sigs/kind/blob/main/pkg/build/nodeimage/const_storage.go)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@2b82bed39fe5:/kind#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /kind/manifests/default-storage.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prepare containerd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@3c6a0ef234f2:/usr/bin#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pull all other images that aren&#39;t in kube-{apiserver,controller-manager,proxy,scheduler}.tar</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># e.g. etcd, coredns, CNI, storage images</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@3c6a0ef234f2:/usr/bin#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ctr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --namespace=k8s.io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --platform=linux/arm64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.k8s.io/etcd:3.5.4-0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registry.k8s.io/etcd:3.5.4-0:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                     resolved</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index-sha256:6f72b851544986cb0921b53ea655ec04c36131248f16d4ad110cb3ca0c369dc1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">manifest-sha256:789b385ccf97973273adf46778fe13993c143b217406d97d63b6da405e757950:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">layer-sha256:8fe6b49c57cd2bce2f1af362f358640470d5131c407c12e10631b30964ad59af:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config-sha256:8e041a3b0ba8b5f930b1732f7e2ddb654b1739c89b068ff433008d633a51cd03:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">layer-sha256:b0b160e41cf35d4a469a1209cfd553534b248053060de060cbbc4a5d912ad5f0:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">layer-sha256:5234205a96191526218ff32a9f34ddaa1382152f0f4d4250734fd9eb3fa29b8a:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">layer-sha256:6e653fb4572b38c44535186ff007c88f43f00a1cbf1e73d402bfde32c5ed47cb:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">layer-sha256:53e4b5eb44b3ba10af4adf9f6f118262bfbbdca54fad127e92648a0b2be0961c:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">++++++++++++++++++++++++++++++++++++++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">elapsed:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                                    total:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  76.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> M</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (10.5 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MiB/s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unpacking</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linux/arm64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sha256:6f72b851544986cb0921b53ea655ec04c36131248f16d4ad110cb3ca0c369dc1...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">done: 947.555625ms</span></span></code></pre></div><ul><li>Updates the docker image manifests so that don&#39;t have the arch suffix</li><li>Final list of images imported into the builder image</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>root@6f7a5781ab5c:/# ctr --namespace=k8s.io images ls -q</span></span>
<span class="line"><span>docker.io/kindest/kindnetd:v20211122-a2c10462</span></span>
<span class="line"><span>docker.io/rancher/local-path-provisioner:v0.0.14</span></span>
<span class="line"><span>k8s.gcr.io/build-image/debian-base:buster-v1.7.2</span></span>
<span class="line"><span>k8s.gcr.io/pause:3.6</span></span>
<span class="line"><span>registry.k8s.io/coredns/coredns:v1.9.3</span></span>
<span class="line"><span>registry.k8s.io/etcd:3.5.4-0</span></span>
<span class="line"><span>registry.k8s.io/kube-apiserver:v1.25.0-dirty</span></span>
<span class="line"><span>registry.k8s.io/kube-controller-manager:v1.25.0-dirty</span></span>
<span class="line"><span>registry.k8s.io/kube-proxy:v1.25.0-dirty</span></span>
<span class="line"><span>registry.k8s.io/kube-scheduler:v1.25.0-dirty</span></span>
<span class="line"><span>sha256:2a2fd040c30da1fa7d5f115701fdd98180b585ed5fb40f126a3ba9f73e7588e7</span></span>
<span class="line"><span>sha256:2b703ea309660ea944a48f41bb7a55716d84427cf5e04b8078bcdc44fa4ab2eb</span></span>
<span class="line"><span>sha256:31c800ce66b59baf852bf24f41cda75b65b65cae19ee224432d2f555b83d658c</span></span>
<span class="line"><span>sha256:7d46a07936af93fcce097459055f93ab07331509aa55f4a2a90d95a3ace1850e</span></span>
<span class="line"><span>sha256:7ee5a0f818e59c7e242414ddfa4f2aff3193b4f01046905a2b222d1ebc870927</span></span>
<span class="line"><span>sha256:8e041a3b0ba8b5f930b1732f7e2ddb654b1739c89b068ff433008d633a51cd03</span></span>
<span class="line"><span>sha256:ae1c622332ee60e894e68977e4b007577678b193cba45fb49203225bb3ef8b05</span></span>
<span class="line"><span>sha256:b19406328e70dd2f6a36d6dbe4e867b0684ced2fdeb2f02ecb54ead39ec0bac0</span></span>
<span class="line"><span>sha256:d0a7325ee7ba50b31fb10dd5d4233ed9bbbc1dedd1166e754f634f94a214869a</span></span>
<span class="line"><span>sha256:e767a71db6387bd20f674911160ae2fd3aa454d850d3fb1c0fa8bcb44f942537</span></span></code></pre></div><ul><li>Commit these changes to a new image with <code>docker commit</code></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker image</span></span>
<span class="line"><span>REPOSITORY     TAG      IMAGE ID       CREATED          SIZE</span></span>
<span class="line"><span>kindest/node   latest   261731b26d54   11 minutes ago   1.37GB</span></span></code></pre></div><ul><li>This is the base image used in the kind nodes 😃</li></ul>`,37)])])}const o=i(h,[["render",l]]);export{g as __pageData,o as default};
